;****************************************************************
;	BMAIN.ASM     						*
;								*
;								*
;****************************************************************

INCLUDE	STD.H
INT_NO	EQU	65H

	COMSEG

@S:	JMP	SET

OLD_OFF	DW	0
OLD_SEG	DW	0
SIN	DB	"INT65"

ENT:
	PUSHA

	MOV	AH,03H
	XOR	BX,BX
	INT	10H
	MOV	Y,DH
	MOV	X,DL
	
	MOV	AH,02H
	MOV	DH,0
	MOV	DL,0
	XOR	BX,BX
	INT	10H
	
	MOV	AL,"D"
	INT	29H
	MOV	AL,"S"
	INT	29H
	MOV	AL,"="
	INT	29H
	MOV	DX,DS
	MOV	AL,DH
	CALL	SUB
	MOV	BL,AL
	XCHG	AH,AL
	INT	29H
	MOV	AL,BL
	INT	29H
	
	MOV	AL,DL
	CALL	SUB
	MOV	BL,AL
	XCHG	AH,AL
	INT	29H
	MOV	AL,BL
	INT	29H
	MOV	AL," "
	INT	29H
	
	
	MOV	AL,"E"
	INT	29H
	MOV	AL,"S"
	INT	29H
	MOV	AL,"="
	INT	29H
	MOV	DX,ES
	MOV	AL,DH
	CALL	SUB
	MOV	BL,AL
	XCHG	AH,AL
	INT	29H
	MOV	AL,BL
	INT	29H
	
	MOV	AL,DL
	CALL	SUB
	MOV	BL,AL
	XCHG	AH,AL
	INT	29H
	MOV	AL,BL
	INT	29H
	MOV	AL," "
	INT	29H
	
	MOV	AL,"S"
	INT	29H
	MOV	AL,"I"
	INT	29H
	MOV	AL,"="
	INT	29H
	MOV	DX,SI
	MOV	AL,DH
	CALL	SUB
	MOV	BL,AL
	XCHG	AH,AL
	INT	29H
	MOV	AL,BL
	INT	29H
	
	MOV	AL,DL
	CALL	SUB
	MOV	BL,AL
	XCHG	AH,AL
	INT	29H
	MOV	AL,BL
	INT	29H
	MOV	AL," "
	INT	29H
	
	MOV	AL,"D"
	INT	29H
	MOV	AL,"I"
	INT	29H
	MOV	AL,"="
	INT	29H
	MOV	DX,DI
	MOV	AL,DH
	CALL	SUB
	MOV	BL,AL
	XCHG	AH,AL
	INT	29H
	MOV	AL,BL
	INT	29H
	
	MOV	AL,DL
	CALL	SUB
	MOV	BL,AL
	XCHG	AH,AL
	INT	29H
	MOV	AL,BL
	INT	29H
	MOV	AL," "
	INT	29H
	
	MOV	AL,"["
	INT	29H
	MOV	AL,"S"
	INT	29H
	MOV	AL,"I"
	INT	29H
	MOV	AL,"]"
	INT	29H
	MOV	AL,"="
	INT	29H
	MOV	DX,[SI]
	MOV	AL,DL
	INT	29H
	MOV	AL,DH
	INT	29H
	MOV	AL," "
	INT	29H
	
	MOV	AL,"["
	INT	29H
	MOV	AL,"D"
	INT	29H
	MOV	AL,"I"
	INT	29H
	MOV	AL,"]"
	INT	29H
	MOV	AL,"="
	INT	29H
	MOV	DX,[DI]
	MOV	AL,DL
	INT	29H
	MOV	AL,DH
	INT	29H
	MOV	AL," "
	INT	29H
	
	MOV	AH,02H
	MOV	DH,Y
	MOV	DL,X
	XOR	BX,BX
	INT	10H
	
	
	POPA
	IRET

Y	DB	0
X	DB	0

	
SUB	PROC	NEAR
	
@1:
	PUSHA
	
	MOV	DL,AL
	MOV	CL,4
	SHR	AL,CL
	CMP	AL,9				;
	JA	@2
	ADD	AL,30H
	JMP	SHORT	@3
@2:
	ADD	AL,37H
@3:
	MOV	WORK[0],AL
	
	MOV	AL,DL
	AND	AL,00001111B
	CMP	AL,9				;
	JA	@4
	ADD	AL,30H
	JMP	SHORT	@5
@4:
	ADD	AL,37H
@5:
	MOV	WORK[1],AL
	
	POPA
	
	MOV	AH,WORK[0]
	MOV	AL,WORK[1]
	
	RET
	
WORK	DB	0,0

SUB	ENDP

	STACK	128
	EVEN
SIZE1	EQU	$

SET:
	MOV	AH,35H
	MOV	AL,INT_NO
	INT	21H
	MOV	OLD_OFF,BX
	MOV	OLD_SEG,ES

	SUB	BX,5
	MOV	DI,BX
	MOV	SI,OFFSET CHK
	MOV	CX,5
	REPZ	CMPSB
	JNE	INT_SET
	
	MOV	AH,09
	MOV	DX,OFFSET M
	INT	21H
	
	MOV	BX,OLD_OFF
	MOV	ES,OLD_SEG
	MOV	DX,ES:[BX-9]
	MOV	DS,ES:[BX-7]
	MOV	AH,25H
	MOV	AL,INT_NO
	INT	21H
	
	MOV	ES,CS:OLD_SEG
	MOV	ES,WORD PTR ES:[002CH]
	MOV	AH,49H
	INT	21H
	MOV	ES,CS:OLD_SEG
	MOV	AH,49H
	INT	21H
	
	EXIT

INT_SET:
	MOV	AH,09H
	MOV	DX,OFFSET M1
	INT	21H
	
	MOV	DX,OFFSET ENT
	MOV	AH,25H
	MOV	AL,INT_NO
	INT	21H
	
	MOV	DX,OFFSET SIZE1
	MOV	CL,4
	SHR	DX,CL
	MOV	AX,3100H
	INT	21H
	
	EXIT
	
CHK	DB	"INT65",0
M	DB	"INTVECT âï˙ÇµÇ‹ÇµÇΩÅB$"
M1	DB	"INTVECT èÌíìÇµÇ‹ÇµÇΩÅB$"
	
	SEGEND

	END	@S
