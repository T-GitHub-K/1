
INCLUDE	MDOS.H
INCLUDE	MACRO.H
INCLUDE	STD.H

BUF_SIZE	EQU	5124
L_ADD		EQU	0F000H		;BLOAD address = DS:F000
OFSET		EQU	L_ADD-7


PARA_OP	STRUC				;スタック受渡テーブル
	BP_SV	DW	?		;BP退避
	R_ADD	DD	?		;RETURN	ADD
	NO_P	DW	?		;FILE No
PARA_OP	ENDS


CODE	SEGMENT	PUBLIC
	ASSUME	CS:CODE,DS:CODE,SS:CODE,ES:CODE

	DB	0FDH
	DW	0000H
	DW	L_ADD
	DW	endp - startp

	PUBLIC	MAIN

startp	EQU	$

MAIN	PROC	FAR

	PUSH	BP		;BPスタックに退避	
	MOV	BP,SP		;スタックポイントBPにMOVE
	PUSHA			;全レジスタ退避

;		OPEN_HANDLE	FILE_NAM[OFSET],2H	;ﾘｰﾄﾞ/ﾗｲﾄﾓｰﾄﾞ

                MOV	DX,OFFSET FILE_NAM[OFSET]
		MOV	AL,02H
		MOV	AH,3DH
		INT	21H

		JC	NEXT
		JMP	EXIT
NEXT:
		CMP	AX,02H				;ﾊﾟｽ名無効
		JZ	MAKE_FILE
		CMP	AX,03H				;ﾊﾟｽ名無効
		JZ	MAKE_FILE
		MOV	AX,9900H
		JMP	EXIT

MAKE_FILE:

;		CREATE_HANDLE	FILE_NAM[OFSET],0

                MOV	DX,OFFSET FILE_NAM[OFSET]
		MOV	CX,00H
		MOV	AH,3CH
		INT	21H

		JC	MEKE_ERR
		JMP	EXIT

MEKE_ERR:
		MOV	AX,9900H

EXIT:
	MOV	BX,[BP].NO_P	;ファイルNo RETURNアドレス取得
	MOV	[BX],AX
	POPA
        POP	BP

	RET	2

FILE_NAM	DB	"E:MMASN.UD",0


MAIN	ENDP
endp	EQU	$

CODE		ENDS
		END
