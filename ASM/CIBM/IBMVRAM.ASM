;****************************************************************
;	BMAIN.ASM     						*
;								*
;								*
;****************************************************************

INCLUDE	STD.H
INT_NO	EQU	1CH
CO_NO	EQU	0EH

	COMSEG

@S:	JMP	SET

OLD_OFF	DW	0
OLD_SEG	DW	0
SIN	DB	"INT1C"

ENT:
	PUSHA
	PUSH	ES
	PUSH	DS
	
	MOV	AX,CS
	MOV	DS,AX
	
	MOV	AX,0B800H
	MOV	ES,AX
	XOR	DI,DI
	MOV	AH,0FEH
	INT	10H
	
	ADD	DI,144
	
	
	MOV	STK_ES,ES
	MOV	STK_DI,DI

	MOV	AH,02
	INT	1AH
	
	MOV	AL,CH
	CALL	SUB
	MOV	H[0],AH
	MOV	H[2],AL
	
	MOV	AL,CL
	CALL	SUB
	MOV	M[0],AH
	MOV	M[2],AL
	
	MOV	AL,DH
	CALL	SUB
	MOV	S[0],AH
	MOV	S[2],AL

	MOV	ES,STK_ES
	MOV	DI,STK_DI
	
	CLD
	MOV	SI,OFFSET H
	MOV	CX,16
	REP	MOVSB
	
	MOV	DI,STK_DI
	MOV	CX,8
	MOV	AH,0FFH
	INT	10H
	
END_T1:	
	POP	DS
	POP	ES
	POPA
	IRET
;	JMP	DWORD	PTR OLD_OFF

H	DB	0,CO_NO,0,CO_NO,":",CO_NO
M	DB	0,CO_NO,0,CO_NO,":",CO_NO
S	DB	0,CO_NO,0,CO_NO
STK_ES	DW	0
STK_DI	DW	0

SUB	PROC	NEAR
	
@1:
	PUSHA
	
	MOV	DL,AL
	MOV	CL,4
	SHR	AL,CL
	CMP	AL,9				;
	JA	@2
	ADD	AL,30H
	JMP	SHORT	@3
@2:
	ADD	AL,37H
@3:
	MOV	WORK[0],AL
	
	MOV	AL,DL
	AND	AL,00001111B
	CMP	AL,9				;
	JA	@4
	ADD	AL,30H
	JMP	SHORT	@5
@4:
	ADD	AL,37H
@5:
	MOV	WORK[1],AL
	
	POPA
	
	MOV	AH,WORK[0]
	MOV	AL,WORK[1]
	
	RET
	
WORK	DB	0,0

SUB	ENDP

	STACK	128
	EVEN
SIZE1	EQU	$

SET:
	MOV	AH,35H
	MOV	AL,INT_NO
	INT	21H
	MOV	OLD_OFF,BX
	MOV	OLD_SEG,ES

	SUB	BX,5
	MOV	DI,BX
	MOV	SI,OFFSET CHK
	MOV	CX,5
	REPZ	CMPSB
	JNE	INT_SET
	
	MOV	AH,09
	MOV	DX,OFFSET M0
	INT	21H
	
	MOV	BX,OLD_OFF
	MOV	ES,OLD_SEG
	MOV	DX,ES:[BX-9]
	MOV	DS,ES:[BX-7]
	MOV	AH,25H
	MOV	AL,INT_NO
	INT	21H
	
	MOV	ES,CS:OLD_SEG
	MOV	ES,WORD PTR ES:[002CH]
	MOV	AH,49H
	INT	21H
	MOV	ES,CS:OLD_SEG
	MOV	AH,49H
	INT	21H
	
	EXIT

INT_SET:
	MOV	AH,09H
	MOV	DX,OFFSET M1
	INT	21H
	
	MOV	DX,OFFSET ENT
	MOV	AH,25H
	MOV	AL,INT_NO
	INT	21H
	
	MOV	DX,OFFSET SIZE1
	MOV	CL,4
	SHR	DX,CL
	MOV	AX,3100H
	INT	21H
	
	EXIT
	
CHK	DB	"INT1C",0
M0	DB	"IBM_TIME âï˙ÇµÇ‹ÇµÇΩÅB$"
M1	DB	"IBM_TIME èÌíìÇµÇ‹ÇµÇΩÅB$"
	
	SEGEND

	END	@S
